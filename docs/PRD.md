# PRD: タイムトラッキングアプリ

## 1. 概要

個人的な時間管理を目的としたWebベースのタイムトラッキングアプリケーション。
作業時間の記録・可視化・分析・データ管理を4つのタブ画面で提供する。

## 2. 技術スタック

| レイヤー | 技術 |
|---------|------|
| フロントエンド | React（TypeScript） |
| バックエンド | Python（FastAPI） |
| データベース | PostgreSQL |
| 実行環境 | Docker（docker-compose） |
| 接続ポート | **9400**（ホスト側） |

### コンテナ構成

| コンテナ | 役割 |
|---------|------|
| frontend | React アプリ（Nginx で静的配信） |
| backend | FastAPI アプリ |
| db | PostgreSQL |

## 3. 共通仕様

### 3.1 認証

- 認証なし（個人利用前提）

### 3.2 UI / デザイン

- **フォント**: Zen Old Mincho（Google Fonts より読み込み）
- **カラーテーマ**: ダークティール基調のグラデーション
  - 背景: ダーク系（#1a2332 〜 #2d4a5e）
  - アクセント: ティール〜シアン系グラデーション（#2d8a8a 〜 #5ec4c4）
  - テキスト: ホワイト（#ffffff）/ ライトティール（#a0d2d2）
  - カード背景: 半透明ダーク（rgba(255,255,255,0.05)）
  - ボタン: ティール系グラデーション
- **表示言語**: 日本語
- **画面構成**: タブ切り替え式の4画面
  - タブ1: タイムトラッカー
  - タブ2: タイムライン
  - タブ3: レポート
  - タブ4: データ管理
- **レスポンシブ対応**: デスクトップブラウザでの利用を主とする（最低幅 1024px）

## 4. データモデル

### 4.1 作業記録（work_entries）

| カラム | 型 | 説明 |
|-------|-----|------|
| id | UUID | 主キー |
| task_name | VARCHAR(255) | タスク名（必須） |
| project_name | VARCHAR(255) | プロジェクト名（必須） |
| category | VARCHAR(255) | カテゴリ（必須） |
| work_date | DATE | 作業日 |
| start_time | TIME | 作業開始時刻 |
| end_time | TIME | 作業終了時刻 |
| duration_seconds | INTEGER | 作業時間（秒） |
| created_at | TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | 更新日時 |

## 5. 画面仕様

---

### 5.1 画面1: タイムトラッカー

作業時間のリアルタイム計測を行う画面。

#### 5.1.1 入力フォーム

| 項目 | 種別 | 必須 | 説明 |
|------|------|------|------|
| タスク名 | テキスト入力 | ○ | 自由入力。過去の作業記録に基づきサジェスト表示 |
| プロジェクト名 | テキスト入力 | ○ | 自由入力。過去の作業記録に基づきサジェスト表示 |
| カテゴリ | テキスト入力 | ○ | 自由入力。過去の作業記録に基づきサジェスト表示 |

#### 5.1.2 サジェスト機能

- 各入力フィールドでフォーカス時またはテキスト入力時に、過去の作業記録からユニークな値を取得しドロップダウンで表示する
- 入力テキストによる部分一致フィルタリングを行う
- サジェスト項目をクリックすると入力欄に反映される

#### 5.1.3 円形トラッカー

- 画面中央にSVGベースの円形プログレスリングを表示する
- **リングの進行**: 60分で1周。60分を超えた場合はリセットされ再度進行する
- リングの内側にデジタル表示で経過時間を表示する（HH:MM:SS形式）
- リングの色はアクセントカラー（ティール〜シアン系）

#### 5.1.4 操作ボタン

| ボタン | 動作 | 条件 |
|--------|------|------|
| スタート | トラッキング開始。タイマーのカウントアップとリングのアニメーション開始 | 全入力項目が入力済みの場合のみ有効 |
| ストップ | トラッキング停止。作業記録をDBに保存 | トラッキング中のみ表示 |

#### 5.1.5 作業記録の保存内容

ストップボタン押下時に以下のデータをDBに記録する:

- タスク名
- プロジェクト名
- カテゴリ
- 作業日（スタート時点の日付）
- 作業開始時刻（スタートボタン押下時刻）
- 作業終了時刻（ストップボタン押下時刻）
- 作業時間（秒単位で算出）

---

### 5.2 画面2: タイムライン

カレンダー形式で作業履歴を表示する画面。

#### 5.2.1 カレンダー表示

- **表示形式**: 週単位のカレンダー（横軸: 曜日、縦軸: 時間）
- **表示曜日**: 月曜日〜金曜日（土日は非表示）
- **表示時間帯**: 6:00〜22:00
- **時間軸の目盛り**: 1時間単位
- 各作業記録をカレンダー上にブロック（カード）として配置する
  - ブロックの縦幅は作業時間に比例する
  - ブロックには「タスク名」「プロジェクト名」「開始時刻 - 終了時刻」を表示する
  - プロジェクト名ごとに異なるカラーをブロックに割り当てる

#### 5.2.2 週切り替え

- 「前の週」「次の週」ボタンで表示週を切り替える
- 現在表示中の週の期間（例: 2026/02/16 - 2026/02/20）をヘッダーに表示する
- 「今週」ボタンで現在の週に戻る

#### 5.2.3 作業記録の詳細表示・編集

- カレンダー上のブロックをクリックすると、モーダルダイアログで詳細を表示する
- モーダル内で以下の項目を編集可能とする:
  - タスク名
  - プロジェクト名
  - カテゴリ
  - 作業日（日付ピッカー）
  - 作業開始時刻（タイムピッカー）
  - 作業終了時刻（タイムピッカー）
- 「保存」ボタンで変更をDBに反映する
- 「削除」ボタンで確認ダイアログを表示した後、作業記録を削除する

#### 5.2.4 作業記録の手動追加

- 画面上の「追加」ボタンをクリックすると、モーダルダイアログを表示する
- 入力項目:
  - タスク名（必須）
  - プロジェクト名（必須）
  - カテゴリ（必須）
  - 作業日（必須、日付ピッカー）
  - 作業開始時刻（必須、タイムピッカー）
  - 作業終了時刻（必須、タイムピッカー）
- 各テキスト入力項目にはサジェスト機能を適用する
- 「登録」ボタンでDBに保存する

---

### 5.3 画面3: レポート

作業時間の集計結果をドーナツグラフで可視化する画面。

#### 5.3.1 期間指定

- **From - To** の日付ピッカーで表示期間を指定する
- **最長期間**: 12ヶ月。12ヶ月を超える範囲が指定された場合はエラーメッセージを表示する
- **デフォルト**: 当月（月初〜当日）

#### 5.3.2 ドーナツグラフ

- **中央表示**: 指定期間内の総作業時間（HH:MM:SS形式）と集計単位ラベル
- **セグメント**: 各プロジェクト（またはカテゴリ）ごとの作業時間割合
- 各セグメントにパーセンテージを表示する
- セグメントごとに異なるカラーを割り当てる

#### 5.3.3 集計単位の切り替え

| モード | 説明 |
|--------|------|
| プロジェクト単位（デフォルト） | プロジェクト名ごとに作業時間を集計 |
| カテゴリ単位 | カテゴリごとに作業時間を集計 |

- ドロップダウンまたはトグルで切り替える

#### 5.3.4 フィルタ機能

- **プロジェクトフィルタ**: 特定のプロジェクトのみに絞り込み
- **カテゴリフィルタ**: 特定のカテゴリのみに絞り込み
- フィルタはマルチセレクト形式（複数選択可能）
- フィルタ適用時、グラフと総作業時間がリアルタイムで更新される
- フィルタの選択肢は指定期間内に存在するデータから取得する

---

### 5.4 画面4: データ管理

データのエクスポートおよび削除を行う画面。

#### 5.4.1 CSVエクスポート

- **期間指定**: From - To の日付ピッカー（最長12ヶ月）
- 「エクスポート」ボタンをクリックすると、指定期間の作業記録をCSVファイルとしてダウンロードする
- **CSVカラム**:
  - タスク名
  - プロジェクト名
  - カテゴリ
  - 作業日
  - 開始時刻
  - 終了時刻
  - 作業時間（HH:MM:SS形式）
- **ファイル名**: `time_tracking_YYYYMMDD_YYYYMMDD.csv`（期間の From_To）
- 12ヶ月を超える範囲が指定された場合はエラーメッセージを表示する

#### 5.4.2 データ削除

- **期間指定**: From - To の日付ピッカー（最長12ヶ月）
- 「削除」ボタンをクリックすると確認ポップアップを表示する
  - ポップアップ内容: 「指定期間（YYYY/MM/DD〜YYYY/MM/DD）のデータ X件 を削除します。この操作は取り消せません。よろしいですか？」
  - 「削除する」「キャンセル」ボタンを表示する
- 「削除する」確認後、指定期間のデータをDBから削除する
- 削除完了後、成功メッセージを表示する
- 12ヶ月を超える範囲が指定された場合はエラーメッセージを表示する

## 6. API エンドポイント

### 6.1 作業記録

| メソッド | パス | 説明 |
|---------|------|------|
| GET | /api/entries | 作業記録一覧取得（クエリパラメータで期間フィルタ） |
| POST | /api/entries | 作業記録の新規登録 |
| GET | /api/entries/{id} | 作業記録の個別取得 |
| PUT | /api/entries/{id} | 作業記録の更新 |
| DELETE | /api/entries/{id} | 作業記録の削除 |
| DELETE | /api/entries | 期間指定による一括削除（クエリパラメータ: from, to） |

### 6.2 サジェスト

| メソッド | パス | 説明 |
|---------|------|------|
| GET | /api/suggestions/tasks | タスク名のサジェスト候補取得 |
| GET | /api/suggestions/projects | プロジェクト名のサジェスト候補取得 |
| GET | /api/suggestions/categories | カテゴリのサジェスト候補取得 |

### 6.3 レポート

| メソッド | パス | 説明 |
|---------|------|------|
| GET | /api/reports/summary | 期間・集計単位・フィルタを指定して集計データ取得 |

### 6.4 エクスポート

| メソッド | パス | 説明 |
|---------|------|------|
| GET | /api/export/csv | 期間指定でCSVファイルをダウンロード |

## 7. 非機能要件

| 項目 | 内容 |
|------|------|
| 起動方法 | `docker-compose up` のみでフロント・バック・DBが起動すること |
| データ永続化 | PostgreSQL のデータは Docker Volume で永続化する |
| タイムゾーン | アプリケーションのタイムゾーンはブラウザのローカルタイムゾーンに従う |
| ブラウザ対応 | Chrome最新版での動作を保証 |
